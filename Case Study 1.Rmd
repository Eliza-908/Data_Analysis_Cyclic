---
title: "Cycling Case Study"
author: Eliza Harkins
output: html_document
date: "2022-09-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Executive Summary 

Cyclistic is a bike rental service that offers 2 main tiers of use: a 'casual' pass and a 'member' pass. By examining the rides we aim to provide suggestions for how to encourage casual riders to upgrade to a member, thereby creating higher revenue for the company. 

By performing various analyses, we first validated the integrity of the data. Then we found out that casual members are much more likely to be using the service for exercise or recreation, as opposed to commuting to work. Therefore all marketing efforts should be focused on encouraging those behaviors. In addition we discovered some specific geographic locationns where marketing efforts should be targeted. 

## Background

Cyclistic is attempting to identify different patterns in behavior between casual (non membership) bike riders versus those with an annual pass. 

If we can point out some reasons why a person would be a casual member or a pass holder, we might be able to find insights as to what would make a person want to switch over to a more high revenue tier pass holder. Some reasons might be whether people use the bikes for recreation, exercise, or commute. These insights might identify different segments that the marketing team can then plan specific campaigns around in order to encourage them to become pass holders. 

## Key Stakeholders 
*Lily Moreno* - Director of Marketing, she will use the analysis to inspire marketing campaigns and initiatives  

*Cyclistic Marketing team* - they will be interested in how data is used in order to collect data more effectively in the future

*Cyclistic Executive team* - final say on recommendations and marketing program 

## Data Information

The databse is hosted on AWS under the divvy account that is owned by the City of Chicago but operated by Lyft LLC. 

Data is aggregated monthly and published within the first half of the subsequent month, but not necessarily on a consistent day. Data is occasionally aggregated separately into quarters or years, but this is sporadic. Here are the column names and a description. 

**Reliability:** Data is reliable. Although no margin of error is listed, it’s not very relevant in this case because these are pick up and drop off times rather than a measured variable. The dataset is supported by Lyft, a current and well-funded company.

**Originality:** The data is generated by Lyft LLC that runs the Chicago city bike sharing service so it is original  

**Comprehensiveness:** The data is not comprehensive. Since there is a data privacy element there is no way to identify rides taken by the same person 

**Current:** The last set of data was published September 8, 2022 and this analysis is taking part on September 29, 2022 so it is current 

**Cited:** Lyft is listed as the creator of the data, and they are known as a reliable source as discussed above 

There is a public license [here](https://ride.divvybikes.com/data-license-agreement) that outlines that data can be used for analysis as long as it falls under terms of service, which this analysis sticks to. 
While examining the data, it was confirmed that all id’s were indeed unique, the trip dates while not all unique fell on reasonable time frames and were contained in the month that the csv file indicated. In addition, confirmed that there was a consistency between the station name, id, and latitude an longitude, which would suggest that no tampering had occurred in the data. 
The database provides trip data on starting and ending location and date, as well as whether that member is a casual user or if they are a member
Since people cannot be identified there is no way to figure out behavior as people and can only make conclusions based on the nature of individual trips. There were no null data or formatting issues in the data used in this analysis. 

# Analysis

## Setting up environment 

The first step is to download and load all the necessary packages needed for cleaning, analyzing, and presenting the data. Then the database was imported from a csv file. Only the last month of data was used, as that gave us over 60,000 trips for analysis. More data was available and the proocess can be repeated for any length of time required. 

```{r, results='hide', message=FALSE}
setwd('/Users/eliza/downloads')
library(knitr)
library(markdown)
library(tidyr)
library(tidyverse)
library(sf)
library(mapview)
library(leafem)
divvy_data <- read_csv("202208-divvy-tripdata.csv")
```

## Cleaning and verifying data

Once we had a dataframe, we had to verify the integrity of the dat and clean it. By observing the dataset, we could see that several trips had missing data. Without further information on why data was missing or how to handle missing data, the best recourse was to remove any rows that did not have data in every column. Next we wanted to make sure the data was correct. After connfirming all ride ID's were indeed unique, we then looked at specific station id's to confirm that the id, name, and latitude/longitude stayed consistent throughout the dataset. Several station ID's were chosen at random and examined to check this result. A more exhaustive method would have been to cycle through every single ID and flag any times when the ID did not match the name or geographical location, but this method is far more time consuming and so a simpler method was chosen. We also checked that the start and end times of the rides all fell within the month of August 2022. Note that this applies to start times, it is possible that some rides ended in September. 

``` {r}
cleaned_divvy <- divvy_data[complete.cases(divvy_data), ]
random_select <- filter(cleaned_divvy,start_station_id==125)
starting <- min(cleaned_divvy$started_at)
ending <- max(cleaned_divvy$started_at)
```

Next we wanted to add some columns. The first added was a calculation of the ride lenth in seconds, which was done by subtracting the start time from the end time. We also wanted to identify what weekday each ride was taking place on. 

```{r}
# adding some calculated columns 
cleaned_divvy <- cleaned_divvy %>% 
  mutate(ride_length = as.numeric(ended_at-started_at)) %>%
  mutate(weekday = weekdays(started_at))
```

## Separating data 

Time to actually compare the behaviors of members vs temporary riders. First we separated members and casual, and also created a subset of rides where the starting location matched the ending location. The reasoning is that these trips are unlikely to be work commuters and are likely using the bikes for exercise or recreation. 

For the casual and members the mean ride time was taken and compared. We found that on average casual riders were actually riding around 10 minutes longer than members. This suggests that casual riders are likely exercising as they want to extend the ride to burn extra calories. This conclusion is further supported by looking at the percentage of riders who start and end at the same location. 61% of the time it is casual riders starting and ending at the same place, meaning they are likely leaving from their residence, exercising or visiting sites, and then going back home. Any marketing efforts to attempt to convert casual users to members should therefore be focused on convincing riders to exercise more rather than getting to work. 

```{r}
# separate casual and member 
casual <- cleaned_divvy %>% 
  filter(member_casual=='casual')
member <- cleaned_divvy %>% 
  filter(member_casual=='member')
same_start_end <- cleaned_divvy %>% 
  filter(start_station_id==end_station_id)

# calculate statistics about the ride times
mean_casual <- mean(casual$ride_length)
mean_member <- mean(member$ride_length)
mean_difference <- (mean_casual-mean_member)/60
cat("The mean ride length time is ",mean_difference," minutes")

# figure out % casual riders start and end at same station
casual_percent_startend <- (sum(same_start_end$member_casual=='casual')/nrow(same_start_end))*100
cat("Casual riders start and end at the same station ",casual_percent_startend,"% of the time")
```

### Weekday vs weekend

It was also important to look at whether casual riders were using bikes more on the weekend than member riders. The results here were suprising, as there was virtually no difference in weekday vs weekend for casual vs member. The average trip for a casual rider on a weekday was 1329 seconds, vs 767 for a member. For weekend, the casual was 1538 seconds whereas for a member it was 855 seconds. So for both members and casual the weekend resulted in a ride that was on average about 200 seconds longer. Casual riders had longer rides on both weekdays and weekends. This would suggest any promotion around encouraging membership sign up based on days of the week would not be very effective, as the general behavior was not much different. 

```{r}
# weekend vs weekdays
weekday_casual <- casual %>% 
  filter(weekday=="Monday"|weekday=="Tuesday"|weekday=="Wednesday"|weekday=="Thursday"|weekday=="Friday") %>% 
  summarise(mean(ride_length))

weekend_casual <- casual %>% 
  filter(weekday=="Saturday"|weekday=="Sunday") %>% 
  summarise(mean(ride_length))

weekday_member <- member %>% 
  filter(weekday=="Monday"|weekday=="Tuesday"|weekday=="Wednesday"|weekday=="Thursday"|weekday=="Friday") %>% 
  summarise(mean(ride_length))

weekend_member <- member %>% 
  filter(weekday=="Saturday"|weekday=="Sunday") %>% 
  summarise(mean(ride_length))

day_casual <- casual %>% 
  group_by(weekday) %>% 
  summarize(ride = mean(ride_length))

day_member <- member %>% 
  group_by(weekday) %>% 
  summarize(ride = mean(ride_length))
```

### Popular locations

Next up we want to look at which stations were most popular with casual vs members. Looking at the top 10 for both, we see overlap in 4 stations: Streeter Dr & Grand Ave, DuSable Lake Shore Dr & North Blvd, Theater on the Lake, and Wells St & Concord Ln. The rest are different. These 4 locations are probably good candidates to encourage casual riders to become members, as many of their peers decided to upgrade. All the rest are different for the two, perhaps suggesting more tourist areas vs. residential neighborhoods. For casual riders, Streeter Dr & Grand Ave was the outlier majority of rides. This is also where the famous Navy Pier is located, one of the biggest tourist spots in Chicago. Identifying Chicago residents from tourists in town for the day is difficult with anonymized data however, so more data should be collected to target these specific people. 

```{r}
# where are the 10 most popular stations for both kinds
most_popular_stations_casual <- casual %>% 
  count(start_station_name) %>% 
  arrange(desc(n)) %>% 
  slice(1:10)

most_popular_stations_member <- member %>% 
  count(start_station_name) %>% 
  arrange(desc(n)) %>% 
  slice(1:10)
```

## Plots 

The first plots we looked at were for the most popular stations, as discussed above. Shown as a bar chart, the plot shows how member stations are more uniform whereas casual ones show more emphasis on tourist locations. The map also shows that casual stations that are popular tend to be along the river. There might be a way to encourage more casual riders to bike along the river more frequently thereby making a membership more attractive. 

We also have a bar chart of frequency of rides on each of the weekdays, showing that weekends are most popular amongst everyone. This brings up a question of whether or not there should be a weekend membership that would attract those who use their bikes more often on the weekend. 

``` {r}
# important plots
ggplot(data = most_popular_stations_casual,aes(x=start_station_name,y=n)) +geom_bar(stat="identity") +coord_flip()
ggplot(data = most_popular_stations_member,aes(x=start_station_name,y=n)) +geom_bar(stat="identity") +coord_flip()
ggplot(data=day_casual,aes(x=weekday,y=ride))+geom_bar(stat="identity")
ggplot(data=day_member,aes(x=weekday,y=ride))+geom_bar(stat="identity")

# map
names <- most_popular_stations_casual$start_station_name
names2 <- most_popular_stations_member$start_station_name
top_casual <- cleaned_divvy %>% 
  distinct(start_station_name,.keep_all = TRUE) %>% 
  filter(start_station_name %in% names)
top_casual_locations <- st_as_sf(top_casual,coords = c("start_lng","start_lat"),crs=4269)
top_member <- cleaned_divvy %>% 
  distinct(start_station_name,.keep_all = TRUE) %>% 
  filter(start_station_name %in% names2)
top_member_locations <- st_as_sf(top_member,coords = c("start_lng","start_lat"),crs=4269)
mapview(list(top_casual_locations,top_member_locations),col.regions=list('red','blue'))
```

# Conclusion 

The data showed some key differences between casual and member riders that might give specific insight into how to encourage more casual riders to become members. The purpose of the bike ride is likely different between the two, so that must be taken into consideration when marketing to them. Also their behaviors might open up new partnerships with gyms or with popular attractions so that even if they do not become members they are more encouraged to take more trips. Information about the users themselves would further the analysis and provide useful insights. 